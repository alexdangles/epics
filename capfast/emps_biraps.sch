[schematic2]
uniq 10
[tools]
[detail]
w 1734 939 100 0 n#1 trcalcos.$(PS):STATUS.INPL 1800 936 1668 936 1668 1016 1520 1016 1520 1840 1112 1840 inhier.enable.P
w 1096 1131 100 0 n#2 trcalcos.$(PS):STATCOMM.SLNK 1208 1128 984 1128 inhier.scanin.P
w 1532 1355 100 0 n#3 trcalcos.$(PS):STATCOMM.FLNK 1496 1352 1568 1352 1568 904 1800 904 trcalcos.$(PS):STATUS.SLNK
w 2091 1348 100 0 n#4 trcalcos.$(PS):STATUS.FLNK 2088 1128 2088 1568 1584 1568 1584 1640 1656 1640 ecalcos.$(PS):DRVDISABLE.SLNK
w 1371 1932 100 0 n#1 junction 1368 1840 1368 2024 1656 2024 ecalcos.$(PS):DRVDISABLE.INPA
w 2912 1427 100 0 n#5 ecalcos.$(PS):CUROK.FLNK 2896 1424 2928 1424 2928 1472 2984 1472 outhier.flink.p
w 2964 1395 100 0 n#6 ecalcos.$(PS):CUROK.VAL 2896 1392 3032 1392 outhier.statok.p
w 2048 1867 100 0 n#7 ecalcos.$(PS):DRVDISABLE.FLNK 1944 1864 2152 1864 2152 1560 2184 1560 ecalcos.$(PS):CURDISABLE.SLNK
w 2496 1787 100 0 n#8 ecalcos.$(PS):CURDISABLE.FLNK 2472 1784 2520 1784 2520 1200 2608 1200 ecalcos.$(PS):CUROK.SLNK
w 2536 1755 100 0 n#9 ecalcos.$(PS):CURDISABLE.VAL 2472 1752 2600 1752 2600 1584 2608 1584 ecalcos.$(PS):CUROK.INPA
w 1820 1523 100 0 n#1 junction 1520 1520 2120 1520 2120 1944 2184 1944 ecalcos.$(PS):CURDISABLE.INPA
n 825 786 1146 882 100
LED RULES FOR $(D)$(PS):STATUS:
0: PATH BAD -> RED
1: PATH GOOD -> GREEN
2: DISABLED -> BLACK
_
n 2476 1925 3271 2065 150
Functionality:
CHECK THAT BIRA DEVICE OPTICS ELEMENT IS ON,
COMMUNICATING AND NOT IN TIMEOUT STATE.
Updated for Tune Lock (TUNELOCK macro on symbol) -AD
_
s 2277 1859 100 0 Tune lock disables current setpoint when high-energy grant.
s 2733 1603 100 0 Tune lock and current exceeds threshold causes trip (statok bad)
n 1601 1370 1914 1418 100
CALC does not include STATCOMM
-AD
_
n 1529 1034 1778 1058 100
Replace H with STATCOMM
_
[cell use]
use bb200tr 712 632 100 0 bb200tr#2
xform 0 1992 1432
p 2296 824 150 0 -1 seta:M. Rowe
p 2152 1016 150 0 -1 sets:E-Linac Control System
p 2152 984 100 0 -1 sett0:Machine Protect System
p 2152 952 100 0 -1 sett1:Optics Subsystem - Stream Device PS Status
p 2568 824 150 0 -1 setdat:2016/08/15
p 2328 872 200 0 -1 setd:$Revision: 1.1 $
p 2168 760 150 0 -1 setf:emps_biraps.sch
use trcalcos 1884 795 100 0 $(PS):STATUS
xform 0 1944 1096
p 1828 795 100 0 -1 PV:$(D)
p 1633 1282 100 0 -1 def(INPA):$(PS):STATON
p 1622 1249 100 0 -1 def(INPB):$(PS):STATTMO
p 1644 1214 100 0 -1 def(INPC):$(PS):FAULT
p 1631 1183 100 0 -1 def(INPD):$(PS):INTFLT0
p 1880 1256 150 0 1 CALC:L?((A&!(B&C&D&E&F&G)&H)?1:0):2
p 1879 1235 100 0 1 OCAL:L?!H?3:B?2:!A?1:(!(C|D|E|F|G)?5:0):4
p 2094 1059 100 0 1 def(OUT):$(D)$(PS):STATTEXT PP
p 1880 1000 100 0 1 OOPT:Every Time
p 1878 978 100 0 1 DOPT:Use OCAL
p 1635 1153 100 0 -1 def(INPE):$(PS):INTFLT1
p 1623 1119 100 0 -1 def(INPF):$(PS):KLIXFLT0
p 1625 1086 100 0 -1 def(INPG):$(PS):KLIXFLT1
p 1590 1058 100 0 1 def(INPH):1
p 1565 1024 100 0 0 def(INPI):
p 1624 993 100 0 0 def(INPJ):
use embbis 1250 856 100 0 $(PS):STATTEXT
xform 0 1344 920
p 1286 822 100 0 1 ONVL:1
p 1289 805 100 0 1 TWVL:2
p 1291 788 100 0 1 THVL:3
p 1376 840 100 0 1 ZRST:OK
p 1371 822 100 0 1 ONST:Off
p 1375 803 100 0 1 TWST:Timeout
p 1377 787 100 0 1 THST:Comm.
p 1291 842 100 0 1 ZRVL:0
p 1194 856 100 0 -1 PV:$(D)
p 1293 771 100 0 1 FRVL:4
p 1381 769 100 0 1 FRST:Not Monitored
p 1292 755 100 0 1 FVVL:5
p 1379 752 100 0 1 FVST:Water/Temp.
use inhier 947 1152 100 0 scanin
xform 0 984 1128
use outhier 2955 1502 100 0 flink
xform 0 2968 1472
use inhier 1077 1862 100 0 enable
xform 0 1112 1840
use outhier 2999 1409 100 0 statok
xform 0 3016 1392
use trcalcos 1273 1035 100 0 $(PS):STATCOMM
xform 0 1352 1320
p 1217 1035 100 0 -1 PV:$(D)
p 983 1505 100 0 -1 def(INPA):$(PS):STATON.STAT
p 971 1475 100 0 -1 def(INPB):$(PS):CURRDBK.STAT
p 994 1441 100 0 -1 def(INPC):$(PS):RDVOL.STAT
p 894 1409 100 0 -1 def(INPD):$(PS):RDUNSIGNEDCUR.STAT
p 992 1378 100 0 -1 def(INPE):$(PS):FAULT.STAT
p 993 1346 100 0 -1 def(INPF):$(PS):INTFLT0.STAT
p 974 1311 100 0 -1 def(INPG):$(PS):INTFLT1.STAT
p 987 1279 100 0 -1 def(INPH):$(PS):KLIXFLT0.STAT
p 1288 1480 150 0 1 CALC:!(A&&B&&C&&D&&E&&F&&G&&H&&I)
p 1292 1460 100 0 1 OCAL:0
p 989 1245 100 0 -1 def(INPI):$(PS):KLIXFLT1.STAT
use ecalcos 1703 1540 100 0 $(PS):DRVDISABLE
xform 0 1800 1832
p 1647 1540 100 0 -1 PV:$(D)
p 1736 1992 150 0 1 CALC:A&(B=1)
p 1758 1777 100 0 1 def(OUT):$(PS):DRVNOCHANGE.DISA
p 1740 1972 100 0 1 OCAL:0
p 1476 1985 100 0 -1 def(INPB):$(D)$(PS):STATUS
p 1736 1736 100 0 1 OOPT:On Change
use ecalcos 2231 1460 100 0 $(PS):CURDISABLE
xform 0 2328 1752
p 2175 1460 100 0 -1 PV:$(D)
p 2264 1912 150 0 1 CALC:(A=1)&B&C
p 2277 1693 100 0 1 def(OUT):$(PS):CUR.DISP PP MS
p 2268 1892 100 0 1 OCAL:0
p 1968 1908 100 0 1 def(INPB):$(TUNELOCK)
p 2264 1656 100 0 1 OOPT:On Change
p 1943 1875 100 0 1 def(INPC):EMPS:TUNELOCK
p 1931 1839 100 0 0 def(INPD):
p 1938 1810 100 0 0 def(INPE):
p 1923 1776 100 0 0 def(INPF):
p 2043 1938 100 0 0 def(INPA):
p 2072 1848 100 0 -1 def(FLNK):
p 2236 1596 100 0 0 SCAN:Passive
use ecalcos 2655 1100 100 0 $(PS):CUROK
xform 0 2752 1392
p 2599 1100 100 0 -1 PV:$(D)
p 2691 1555 150 0 1 CALC:A?B&(ABS(C-D)<(0.005*ABS(E-F))):B
p 2916 1353 100 0 1 def(OUT):$(D)$(PS):TLSTATTEXT PP
p 2692 1532 100 0 1 OCAL:A?((ABS(C-D)>=(0.005*ABS(E-F)))?2:1):0
p 2448 1544 100 0 -1 def(INPB):$(D)$(PS):STATUS
p 2688 1296 100 0 1 OOPT:Every Time
p 2505 1512 100 0 -1 def(INPC):$(PS):CUR
p 2484 1482 100 0 -1 def(INPD):$(PS):RDCUR
p 2454 1451 100 0 -1 def(INPE):$(PS):CUR.DRVH
p 2459 1419 100 0 -1 def(INPF):$(PS):CUR.DRVL
p 2439 1579 100 0 0 def(INPA):
p 2496 1488 100 0 0 def(FLNK):
p 2660 1236 100 0 0 SCAN:Passive
p 2692 1280 100 0 1 DOPT:Use OCAL
use embbis 2890 1192 100 0 $(PS):TLSTATTEXT
xform 0 2984 1256
p 2926 1158 100 0 1 ONVL:1
p 2929 1141 100 0 1 TWVL:2
p 2931 1124 100 0 1 THVL:3
p 3016 1176 100 0 1 ZRST:Unlocked
p 3011 1158 100 0 1 ONST:Locked
p 3015 1139 100 0 1 TWST:Current drift
p 3017 1123 100 0 1 THST:
p 2931 1178 100 0 1 ZRVL:0
p 2834 1192 100 0 -1 PV:$(D)
p 2933 1107 100 0 1 FRVL:4
p 2935 1090 100 0 1 FVVL:5
p 3019 1105 100 0 1 FRST:
p 3019 1087 100 0 1 FVST:
p 2936 1074 100 0 0 SXVL:0
p 3017 1071 100 0 0 SXST:
[comments]

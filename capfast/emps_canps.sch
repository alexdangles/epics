[schematic2]
uniq 8
[tools]
[detail]
w 1004 1563 100 0 n#1 trcalcos.$(PS):STATUS.SLNK 1072 1560 936 1560 inhier.scanin.P
w 1032 1595 100 0 n#2 trcalcos.$(PS):STATUS.INPL 1072 1592 992 1592 992 1624 936 1624 inhier.enable.P
w 2608 1467 100 0 n#3 ecalcos.$(PS):CUROK.VAL 2552 1464 2664 1464 outhier.statok.p
w 1484 1787 100 0 n#4 trcalcos.$(PS):STATUS.FLNK 1360 1784 1608 1784 1608 1512 1696 1512 ecalcos.$(PS):CURDISABLE.SLNK
w 2568 1499 100 0 n#5 ecalcos.$(PS):CUROK.FLNK 2552 1496 2584 1496 2584 1536 2632 1536 outhier.flink.p
w 2040 1739 100 0 n#6 ecalcos.$(PS):CURDISABLE.FLNK 1984 1736 2096 1736 2096 1272 2264 1272 ecalcos.$(PS):CUROK.SLNK
w 2092 1707 100 0 n#7 ecalcos.$(PS):CURDISABLE.VAL 1984 1704 2200 1704 2200 1656 2264 1656 ecalcos.$(PS):CUROK.INPA
w 1010 1602 -100 0 n#2 junction 1000 1592 1000 1400 1656 1400 1656 1864 1696 1864 ecalcos.$(PS):CURDISABLE.INPB
n 1289 1282 1610 1378 100
LED RULES FOR $(D)$(PS):STATUS:
0: PATH BAD -> RED
1: PATH GOOD -> GREEN
2: DISABLED -> BLACK
_
n 2428 1925 3170 2065 150
Functionality:
CHECK THAT CANBUS DEVICE OPTICS ELEMENT IS ON,
COMMUNICATING AND NOT IN TIMEOUT STATE.
Updated for Tune Lock (TL macro on symbol) -AD
_
s 1877 1819 100 0 Tune lock disables current setpoint when high-energy grant.
s 2373 1675 100 0 Tune lock and current exceeds threshold causes trip (statok bad)
[cell use]
use bb200tr 712 632 100 0 bb200tr#2
xform 0 1992 1432
p 2296 824 150 0 -1 seta:M. Rowe
p 2152 1016 150 0 -1 sets:E-Linac Control System
p 2152 984 100 0 -1 sett0:Machine Protect System
p 2152 952 100 0 -1 sett1:Optics Subsystem - Stream Device PS Status
p 2568 824 150 0 -1 setdat:2016/08/15
p 2328 872 200 0 -1 setd:$Revision: 1.1 $
p 2168 760 150 0 -1 setf:emps_canps.sch
use trcalcos 1156 1451 100 0 $(PS):STATUS
xform 0 1216 1752
p 1100 1451 100 0 -1 PV:$(D)
p 905 1938 100 0 -1 def(INPA):$(PS):STATON MS
p 894 1905 100 0 -1 def(INPB):$(PS):STATTMO MS
p 927 1872 100 0 -1 def(INPC):$(PS):ALIVE MS
p 919 1841 100 0 -1 def(INPD):$(PS):STATPRES
p 1152 1912 150 0 1 CALC:L?((A&!B&C&D&!E)?1:0):2
p 1151 1891 100 0 1 OCAL:L?(E?4:(!D|!C?3:(B?2:(!A?1:0)))):5
p 1366 1715 100 0 -1 def(OUT):$(D)$(PS):STATTEXT PP MS
p 1152 1656 100 0 1 OOPT:Every Time
p 1155 1871 100 0 1 DOPT:Use OCAL
p 942 1809 100 0 -1 def(INPE):$(PS):STATLB
use embbis 1346 1520 100 0 $(PS):STATTEXT
xform 0 1440 1584
p 1382 1486 100 0 1 ONVL:1
p 1385 1469 100 0 1 TWVL:2
p 1387 1452 100 0 1 THVL:3
p 1472 1504 100 0 1 ZRST:OK
p 1467 1486 100 0 1 ONST:Off
p 1471 1467 100 0 1 TWST:Timeout
p 1473 1451 100 0 1 THST:CANBUS
p 1387 1506 100 0 1 ZRVL:0
p 1290 1520 100 0 -1 PV:$(D)
p 1389 1435 100 0 1 FRVL:4
p 1391 1418 100 0 1 FVVL:5
p 1475 1433 100 0 1 FRST:Loop Back
p 1475 1415 100 0 1 FVST:Not Monitored
use inhier 899 1584 100 0 scanin
xform 0 936 1560
use outhier 2603 1566 100 0 flink
xform 0 2616 1536
use inhier 901 1646 100 0 enable
xform 0 936 1624
use outhier 2631 1481 100 0 statok
xform 0 2648 1464
use ecalcos 1743 1412 100 0 $(PS):CURDISABLE
xform 0 1840 1704
p 1687 1412 100 0 -1 PV:$(D)
p 1776 1864 150 0 1 CALC:A&(B=1)
p 1789 1645 100 0 1 def(OUT):$(PS):CUR.DISP PP MS
p 1780 1844 100 0 1 OCAL:0
p 1640 1859 100 0 0 def(INPB):
p 1776 1608 100 0 1 OOPT:On Change
p 1475 1825 100 0 0 def(INPC):
p 1443 1791 100 0 0 def(INPD):
p 1450 1762 100 0 0 def(INPE):
p 1435 1728 100 0 0 def(INPF):
p 1555 1890 100 0 1 def(INPA):$(TL)
p 1584 1800 100 0 -1 def(FLNK):
p 1748 1548 100 0 0 SCAN:Passive
use ecalcos 2311 1172 100 0 $(PS):CUROK
xform 0 2408 1464
p 2255 1172 100 0 -1 PV:$(D)
p 2347 1627 150 0 1 CALC:A?B&(ABS(C-D)<(0.005*ABS(E-F))):B
p 2572 1425 100 0 1 def(OUT):$(D)$(PS):TLSTATTEXT PP
p 2348 1604 100 0 1 OCAL:A?((ABS(C-D)>=(0.005*ABS(E-F)))?2:1):0
p 2104 1616 100 0 -1 def(INPB):$(D)$(PS):STATUS
p 2344 1368 100 0 1 OOPT:Every Time
p 2161 1584 100 0 -1 def(INPC):$(PS):CUR
p 2140 1554 100 0 -1 def(INPD):$(PS):RDCUR
p 2110 1523 100 0 -1 def(INPE):$(PS):CUR.DRVH
p 2115 1491 100 0 -1 def(INPF):$(PS):CUR.DRVL
p 2095 1651 100 0 0 def(INPA):
p 2152 1560 100 0 0 def(FLNK):
p 2316 1308 100 0 0 SCAN:Passive
p 2348 1352 100 0 1 DOPT:Use OCAL
use embbis 2578 1272 100 0 $(PS):TLSTATTEXT
xform 0 2672 1336
p 2614 1238 100 0 1 ONVL:1
p 2617 1221 100 0 1 TWVL:2
p 2619 1204 100 0 1 THVL:3
p 2704 1256 100 0 1 ZRST:Unlocked
p 2699 1238 100 0 1 ONST:Locked
p 2703 1219 100 0 1 TWST:Current drift
p 2705 1203 100 0 1 THST:
p 2619 1258 100 0 1 ZRVL:0
p 2522 1272 100 0 -1 PV:$(D)
p 2621 1187 100 0 1 FRVL:4
p 2623 1170 100 0 1 FVVL:5
p 2707 1185 100 0 1 FRST:
p 2707 1167 100 0 1 FVST:
p 2624 1154 100 0 0 SXVL:0
p 2705 1151 100 0 0 SXST:
[comments]

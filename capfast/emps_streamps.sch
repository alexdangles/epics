[schematic2]
uniq 11
[tools]
[detail]
w 1048 1131 100 0 n#1 trcalcos.$(PS):STATCOMM.SLNK 1112 1128 984 1128 inhier.scanin.P
w 1428 1323 100 0 n#2 trcalcos.$(PS):STATCOMM.VAL 1400 1320 1456 1320 1456 1240 1680 1240 trcalcos.$(PS):STATUS.INPC
w 1412 1355 100 0 n#3 trcalcos.$(PS):STATCOMM.FLNK 1400 1352 1424 1352 1424 920 1680 920 trcalcos.$(PS):STATUS.SLNK
w 1372 2027 100 0 n#4 inhier.enable.P 1128 2024 1616 2024 ecalcos.$(PS):DRVDISABLE.INPA
w 1491 1488 100 0 n#4 junction 1488 2024 1488 952 1680 952 trcalcos.$(PS):STATUS.INPL
w 2020 1147 100 0 n#5 trcalcos.$(PS):STATUS.FLNK 1968 1144 2072 1144 2072 1360 1896 1360 1552 1360 1552 1640 1616 1640 ecalcos.$(PS):DRVDISABLE.SLNK
w 1932 1867 100 0 n#6 ecalcos.$(PS):DRVDISABLE.FLNK 1904 1864 1960 1864 1960 1592 2096 1592 ecalcos.$(PS):CURDISABLE.SLNK
w 2448 1787 100 0 n#7 ecalcos.$(PS):CURDISABLE.VAL 2384 1784 2512 1784 2512 1696 ecalcos.$(PS):CUROK.INPA
w 2428 1819 100 0 n#8 ecalcos.$(PS):CURDISABLE.FLNK 2384 1816 2472 1816 2472 1312 2512 1312 ecalcos.$(PS):CUROK.SLNK
w 2820 1539 100 0 n#9 ecalcos.$(PS):CUROK.FLNK 2800 1536 2840 1536 2840 1560 2896 1560 outhier.flink.p
w 2848 1507 100 0 n#10 ecalcos.$(PS):CUROK.VAL 2800 1504 2896 1504 2896 1520 2968 1520 outhier.statok.p
w 1752 1435 100 0 n#4 junction 1488 1432 2016 1432 2016 1976 2096 1976 ecalcos.$(PS):CURDISABLE.INPA
n 2265 1082 2586 1178 100
LED RULES FOR $(D)$(PS):STATUS:
0: PATH BAD -> RED
1: PATH GOOD -> GREEN
2: DISABLED -> BLACK
_
n 2428 1925 3223 2065 150
Functionality:
CHECK THAT STREAM DEVICE OPTICS ELEMENT IS ON,
COMMUNICATING AND NOT IN TIMEOUT STATE.
Updated for Tune Lock (TUNELOCK macro on symbol) -AD
_
s 2621 1715 100 0 Tune lock and current exceeds threshold causes trip (statok bad)
s 2173 1875 100 0 Tune lock disables current setpoint when high-energy grant.
[cell use]
use bb200tr 712 632 100 0 bb200tr#2
xform 0 1992 1432
p 2296 824 150 0 -1 seta:M. Rowe
p 2152 1016 150 0 -1 sets:E-Linac Control System
p 2152 984 100 0 -1 sett0:Machine Protect System
p 2152 952 100 0 -1 sett1:Optics Subsystem - Stream Device PS Status
p 2568 824 150 0 -1 setdat:2016/08/15
p 2328 872 200 0 -1 setd:$Revision: 1.5 $
p 2168 760 150 0 -1 setf:emps_streamps.sch
use trcalcos 1764 811 100 0 $(PS):STATUS
xform 0 1824 1112
p 1708 811 100 0 -1 PV:$(D)
p 1513 1298 100 0 -1 def(INPA):$(PS):STATON
p 1502 1265 100 0 -1 def(INPB):$(PS):STATTMO
p 1458 1233 100 0 0 def(INPC):
p 1468 1201 100 0 0 def(INPD):
p 1760 1272 150 0 1 CALC:L?((A&!B&C)?1:0):2
p 1759 1251 100 0 1 OCAL:L?(!C?3:(B?2:(!A?1:0))):4
p 1974 1075 100 0 1 def(OUT):$(D)$(PS):STATTEXT PP
p 1760 1016 100 0 1 OOPT:Every Time
p 1758 994 100 0 1 DOPT:Use OCAL
p 1468 1169 100 0 0 def(INPE):
p 1375 1136 100 0 0 def(INPF):
p 1469 1105 100 0 0 def(INPG):
p 1470 1074 100 0 0 def(INPH):
p 1445 1040 100 0 0 def(INPI):
p 1504 1009 100 0 0 def(INPJ):
use embbis 2130 1288 100 0 $(PS):STATTEXT
xform 0 2224 1352
p 2166 1254 100 0 1 ONVL:1
p 2169 1237 100 0 1 TWVL:2
p 2171 1220 100 0 1 THVL:3
p 2256 1272 100 0 1 ZRST:OK
p 2251 1254 100 0 1 ONST:Off
p 2255 1235 100 0 1 TWST:Timeout
p 2257 1219 100 0 1 THST:Comm.
p 2171 1274 100 0 1 ZRVL:0
p 2074 1288 100 0 -1 PV:$(D)
p 2173 1203 100 0 1 FRVL:4
p 2261 1201 100 0 1 FRST:Not Monitored
use inhier 947 1152 100 0 scanin
xform 0 984 1128
use outhier 2867 1590 100 0 flink
xform 0 2880 1560
use inhier 1093 2046 100 0 enable
xform 0 1128 2024
use outhier 2935 1537 100 0 statok
xform 0 2952 1520
use trcalcos 1177 1035 100 0 $(PS):STATCOMM
xform 0 1256 1320
p 1121 1035 100 0 -1 PV:$(D)
p 887 1505 100 0 -1 def(INPA):$(PS):STATON.STAT
p 896 1474 100 0 -1 def(INPB):$(PS):RDDAC.STAT
p 898 1441 100 0 -1 def(INPC):$(PS):RDVOL.STAT
p 798 1409 100 0 -1 def(INPD):$(PS):RDUNSIGNEDCUR.STAT
p 896 1378 100 0 -1 def(INPE):$(PS):RDOCP.STAT
p 897 1346 100 0 -1 def(INPF):$(PS):RDOVP.STAT
p 923 1311 100 0 -1 def(INPG):$(PS):IDN.STAT
p 927 1281 100 0 0 def(INPH):
p 1192 1480 150 0 1 CALC:!(A&&B&&C&&D&&E&&F&&G)
p 1196 1460 100 0 1 OCAL:0
use ecalcos 1663 1540 100 0 $(PS):DRVDISABLE
xform 0 1760 1832
p 1607 1540 100 0 -1 PV:$(D)
p 1696 1992 150 0 1 CALC:A&(B=1)
p 1693 1774 100 0 1 def(OUT):$(PS):DRVNOCHANGE.DISA
p 1700 1972 100 0 1 OCAL:0
p 1436 1985 100 0 -1 def(INPB):$(D)$(PS):STATUS
p 1696 1736 100 0 1 OOPT:On Change
use ecalcos 2559 1212 100 0 $(PS):CUROK
xform 0 2656 1504
p 2503 1212 100 0 -1 PV:$(D)
p 2595 1667 150 0 1 CALC:A?B&(ABS(C-D)<(0.005*ABS(E-F))):B
p 2820 1465 100 0 1 def(OUT):$(D)$(PS):TLSTATTEXT PP
p 2596 1644 100 0 1 OCAL:A?((ABS(C-D)>=(0.005*ABS(E-F)))?2:1):0
p 2352 1656 100 0 -1 def(INPB):$(D)$(PS):STATUS
p 2592 1408 100 0 1 OOPT:Every Time
p 2409 1624 100 0 -1 def(INPC):$(PS):CUR
p 2388 1594 100 0 -1 def(INPD):$(PS):RDCUR
p 2358 1563 100 0 -1 def(INPE):$(PS):CUR.DRVH
p 2363 1531 100 0 -1 def(INPF):$(PS):CUR.DRVL
p 2343 1691 100 0 0 def(INPA):
p 2400 1600 100 0 0 def(FLNK):
p 2564 1348 100 0 0 SCAN:Passive
p 2596 1392 100 0 1 DOPT:Use OCAL
use embbis 2826 1312 100 0 $(PS):TLSTATTEXT
xform 0 2920 1376
p 2862 1278 100 0 1 ONVL:1
p 2865 1261 100 0 1 TWVL:2
p 2867 1244 100 0 1 THVL:3
p 2952 1296 100 0 1 ZRST:Unlocked
p 2947 1278 100 0 1 ONST:Locked
p 2951 1259 100 0 1 TWST:Current drift
p 2953 1243 100 0 1 THST:
p 2867 1298 100 0 1 ZRVL:0
p 2770 1312 100 0 -1 PV:$(D)
p 2869 1227 100 0 1 FRVL:4
p 2871 1210 100 0 1 FVVL:5
p 2955 1225 100 0 1 FRST:
p 2955 1207 100 0 1 FVST:
p 2872 1194 100 0 0 SXVL:0
p 2953 1191 100 0 0 SXST:
use ecalcos 2143 1492 100 0 $(PS):CURDISABLE
xform 0 2240 1784
p 2087 1492 100 0 -1 PV:$(D)
p 2176 1944 150 0 1 CALC:(A=1)&B&C
p 2189 1725 100 0 1 def(OUT):$(PS):CUR.DISP PP MS
p 2180 1924 100 0 1 OCAL:0
p 1880 1940 100 0 1 def(INPB):$(TUNELOCK)
p 2176 1688 100 0 1 OOPT:On Change
p 1855 1907 100 0 1 def(INPC):$(D)TUNELOCK
p 1843 1871 100 0 0 def(INPD):
p 1850 1842 100 0 0 def(INPE):
p 1835 1808 100 0 0 def(INPF):
p 1955 1970 100 0 0 def(INPA):
p 1984 1880 100 0 -1 def(FLNK):
p 2148 1628 100 0 0 SCAN:Passive
[comments]
